!function(module){module.config(["$qProvider","$resourceProvider",function($qProvider,$resourceProvider){$qProvider.errorOnUnhandledRejections(!1),$resourceProvider.defaults.cancellable=!0}]).service("RestfulService",["$resource",function($resource){return function(url,paramDefaults,actions){var resource=$resource.apply($resource,arguments);return resource.requests=resource.requests||{},resource.abort=function(method){return method&&resource.requests[method]?(resoure.requests[method].$cancelRequest(),delete resource.requests[method]):(_.invokeMap(resource.requests,"$cancelRequest"),resource.requests={}),resource},_.forEach(_.keys(actions),function(method){var original=resource[method];_.isFunction(original)&&(resource[method]=function(){return resource.requests[method]=original.apply(resource,arguments),resource.requests[method].$promise})}),resource}}]),module.factory("SessionProvider",[function(){return new function(){this.set=function(key,value){return sessionStorage.setItem(key,value)},this.get=function(key){return sessionStorage.getItem(key)},this.remove=function(key){return sessionStorage.removeItem(key)}}}]),module.factory("GamesResource",["RestfulService",function(RestfulService){return RestfulService("rest/games.php",null,{load:{params:{action:"load"}}})}]),module.factory("UsersResource",["RestfulService",function(RestfulService){return RestfulService("rest/users.php",null,{login:{method:"POST",params:{action:"login"}},logout:{method:"POST",params:{action:"logout"}},register:{method:"POST",params:{action:"register"}}})}]),module.config(["$stateProvider",function($stateProvider){$stateProvider.state("games",{abstract:!0,template:"<ui-view />"})}]),module.config(["$stateProvider",function($stateProvider){$stateProvider.state("games.load",{controller:"LoadController",templateUrl:"templates/games/load.html"})}]).controller("LoadController",["$scope","$state","GamesResource","SessionProvider",function($scope,$state,GamesResource,SessionProvider){$scope.model={userId:SessionProvider.get("userId")},$scope.flags={busy:!0},$scope.load=function(){},GamesResource.abort().load().then(function(response){response.success?($scope.games=response.games,$scope.games&&($scope.model.gameId=$scope.games[0].id)):alert(response.message)}).catch(function(error){alert(error)}).finally(function(){$scope.flags.busy=!1})}]),module.controller("RPGController",["$scope","$state","SessionProvider",function($scope,$state,SessionProvider){SessionProvider.get("userId")?$state.transitionTo("games.load"):$state.transitionTo("users.login"),$scope.transitionTo=function(state){$state.transitionTo(state)}}]),module.config(["$stateProvider",function($stateProvider){$stateProvider.state("users.login",{controller:"LoginController",templateUrl:"templates/users/login.html"})}]).controller("LoginController",["$scope","$state","SessionProvider","UsersResource",function($scope,$state,SessionProvider,UsersResource){$scope.flags={busy:!1},$scope.login=function(){$scope.flags.busy=!0,UsersResource.abort().login($scope.model).then(function(response){response.success?(SessionProvider.set("userId",response.id),$state.transitionTo("games.load")):alert(response.message)}).catch(function(error){alert(error)}).finally(function(){$scope.flags.busy=!1})}}]),module.config(["$stateProvider",function($stateProvider){$stateProvider.state("users.logout",{controller:"LogoutController"})}]).controller("LogoutController",["$state","SessionProvider","UsersResource",function($state,SessionProvider,UsersResource){UsersResource.abort().logout().then(function(response){response.success?(SessionProvider.remove("userId"),$state.transitionTo("users.login")):alert(response.message)}).catch(function(error){alert(error)})}]),module.config(["$stateProvider",function($stateProvider){$stateProvider.state("users.register",{controller:"RegisterController",templateUrl:"templates/users/register.html"})}]).controller("RegisterController",["$scope","$state","SessionProvider","UsersResource",function($scope,$state,SessionProvider,UsersResource){$scope.flags={busy:!1},$scope.register=function(){console.log($scope.model),$scope.model.pass===$scope.model.pass2?($scope.flags.busy=!0,UsersResource.abort().register($scope.model).then(function(response){response.success?(SessionProvider.set("userId",response.id),$state.transitionTo("games.load")):alert(response.message)}).catch(function(error){alert(error)}).finally(function(){$scope.flags.busy=!1})):alert("The passwords do not match.")}}]),module.config(["$stateProvider",function($stateProvider){$stateProvider.state("users",{abstract:!0,templateUrl:"templates/users/users.html"})}])}(angular.module("rpg",["ngResource","ui.router"])),angular.module("rpg").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("templates/games/load.html",'<div class="d-flex justify-content-center align-items-center" style="height: 100%;"><div class="jumbotron col-6"><p class=lead>Load Game</p><form ng-submit=load()><div class="form-group row"><div class=col-12><ul class="list-group list-group-flush"><li class="list-group-item list-group-item-action" ng-class="{ active: model.gameId == game.id }" ng-click="model.gameId = 1;" ng-repeat="game in games">{{ game.title }}</li></ul></div></div><div class=row><span class=col-5><button class="btn btn-secondary w-100" ng-disabled=flags.busy ng-click="transitionTo(\'users.logout\');" type=reset>Log Out</button> </span><span class="col-5 offset-2"><button class="btn btn-primary w-100" ng-disabled=flags.busy type=submit>Load Game</button></span></div></form></div></div>'),$templateCache.put("templates/users/login.html",'<div class="jumbotron col-6"><p class=lead>Log In</p><form ng-submit=login()><label class="form-group row"><span class="col-12 input-group"><div class=input-group-prepend><span class=input-group-text><i class="fa fa-user"></i></span></div><input class="form-control col" name=user ng-disabled=flags.busy ng-model=model.user placeholder=Username required/></span></label> <label class="form-group row"><span class="col-12 input-group"><div class=input-group-prepend><span class=input-group-text><i class="fa fa-key"></i></span></div><input class=form-control name=pass ng-disabled=flags.busy ng-model=model.pass placeholder=Password required type=password /></span></label><div class=row><span class=col-5><button class="btn btn-secondary w-100" ng-disabled=flags.busy ng-click="transitionTo(\'users.register\');" type=reset>Register</button> </span><span class="col-5 offset-2"><button class="btn btn-primary w-100" ng-disabled=flags.busy type=submit>Log In</button></span></div></form></div>'),$templateCache.put("templates/users/register.html",'<div class="jumbotron col-6"><p class=lead>Register</p><form ng-submit=register()><label class="form-group row"><span class="col-12 input-group"><div class=input-group-prepend><span class=input-group-text><i class="fa fa-user"></i></span></div><input class="form-control col" name=user ng-disabled=flags.busy ng-model=model.user placeholder=Username required/></span></label> <label class="form-group row"><span class="col-12 input-group"><div class=input-group-prepend><span class=input-group-text><i class="fa fa-envelope"></i></span></div><input class="form-control col" name=email ng-disabled=flags.busy ng-model=model.email placeholder=Email required/></span></label> <label class="form-group row"><span class="col-12 input-group"><div class=input-group-prepend><span class=input-group-text><i class="fa fa-key"></i></span></div><input autocomplete=new-password name=pass class="form-control col" ng-disabled=flags.busy ng-model=model.pass placeholder=Password required type=password /></span></label> <label class="form-group row"><span class="col-12 input-group"><div class=input-group-prepend><span class=input-group-text><i class="fa fa-key"></i></span></div><input autocomplete=new-password name=pass2 class="form-control col" ng-disabled=flags.busy ng-model=model.pass2 placeholder="Password (again)" required type=password /></span></label><div class=row><span class=col-5><button class="btn btn-secondary w-100" ng-disabled=flags.busy ng-click="transitionTo(\'users.login\');" type=reset>Log In</button> </span><span class="col-5 offset-2"><button class="btn btn-primary w-100" ng-disabled=flags.busy type=submit>Register</button></span></div></form></div>'),$templateCache.put("templates/users/users.html",'<div class="d-flex justify-content-center align-items-center" style="height: 100%;" ui-view></div>')}]);